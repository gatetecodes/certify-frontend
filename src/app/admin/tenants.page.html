<div class="grid grid-cols-1 gap-6 lg:grid-cols-12 items-start">
  <!-- List of Tenants (Sidebar) -->
  <aside class="lg:col-span-4 flex flex-col gap-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-bold text-slate-900 flex items-center gap-2">
        Customers
        <span
          class="inline-flex items-center justify-center rounded-full bg-secondary/20 px-2 py-0.5 text-xs font-medium text-secondary-dark"
          *ngIf="(tenants$ | async)?.length"
        >
          {{ (tenants$ | async)?.length }}
        </span>
      </h2>
      <button
        type="button"
        (click)="refresh()"
        [disabled]="loading"
        class="inline-flex items-center gap-1.5 rounded-full bg-white px-3 py-1.5 text-xs font-bold uppercase tracking-wide text-slate-600 border border-slate-200 hover:bg-slate-50 hover:text-slate-900 transition-colors disabled:opacity-50"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-4 h-4"
          [class.animate-spin]="loading"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"
          />
        </svg>
        {{ loading ? "Loading..." : "Refresh" }}
      </button>
    </div>

    <div class="flex flex-col gap-3">
      <ng-container *ngIf="tenants$ | async as tenants; else loadingTpl">
        <div
          *ngIf="tenants.length === 0"
          class="flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-secondary/30 bg-white p-8 text-center"
        >
          <div
            class="mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-secondary/10 text-secondary"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"
              />
            </svg>
          </div>
          <h3 class="text-sm font-semibold text-slate-900">No customers yet</h3>
          <p class="mt-1 text-xs text-slate-500">
            Onboard your first customer using the form.
          </p>
        </div>

        <div
          *ngFor="let tenant of tenants"
          class="group relative rounded-xl border border-slate-200 bg-white p-4 transition-all hover:shadow-sm hover:border-primary/30"
        >
          <div class="flex items-start justify-between">
            <div>
              <div class="font-bold text-slate-900 group-hover:text-primary transition-colors">
                {{ tenant.name }}
              </div>
              <div class="text-xs text-slate-500 font-mono mt-0.5">
                {{ tenant.slug }}
              </div>
              <div class="mt-3 flex flex-wrap items-center gap-3 text-xs text-slate-600">
                <div class="flex items-center gap-1.5" title="Admin Email">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3.5 h-3.5 text-slate-400">
                    <path d="M3 4a2 2 0 00-2 2v1.161l8.441 4.221a1.25 1.25 0 001.118 0L19 7.162V6a2 2 0 00-2-2H3z" />
                    <path d="M19 8.839l-7.77 3.885a2.75 2.75 0 01-2.46 0L1 8.839V14a2 2 0 002 2h14a2 2 0 002-2V8.839z" />
                  </svg>
                  {{ tenant.admin?.email || "—" }}
                </div>
                <div class="flex items-center gap-1.5" title="Created Date">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3.5 h-3.5 text-slate-400">
                    <path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7v-1.25a.75.75 0 011.5 0V4h1.25A2.25 2.25 0 0118.5 6.25v8.5A2.25 2.25 0 0116.25 17H3.75A2.25 2.25 0 011.5 14.75v-8.5A2.25 2.25 0 013.75 4h1.25v-1.25a.75.75 0 01.75-.75zM3 6.25A.75.75 0 013.75 5.5h12.5a.75.75 0 01.75.75v8.5a.75.75 0 01-.75.75H3.75a.75.75 0 01-.75-.75v-8.5z" clip-rule="evenodd" />
                  </svg>
                  {{ tenant.createdAt | date : "mediumDate" }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #loadingTpl>
        <div class="p-8 text-center">
            <div class="inline-block h-6 w-6 animate-spin rounded-full border-2 border-solid border-primary border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]"></div>
            <p class="mt-2 text-sm text-slate-500">Loading customers...</p>
        </div>
      </ng-template>
    </div>
  </aside>

  <!-- Create Form (Main) -->
  <div
    class="lg:col-span-8 rounded-2xl border border-white/50 bg-white p-6 shadow-lg shadow-secondary/5"
  >
    <div
      class="mb-6 flex items-center justify-between border-b border-slate-100 pb-4"
    >
      <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2">
        <div
          class="flex h-8 w-8 items-center justify-center rounded-lg bg-secondary/10 text-secondary"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-5 h-5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
        </div>
        Create New Organization
      </h2>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-6">
      <div
        *ngIf="errorMessage"
        class="mb-2 rounded-lg bg-red-50 border border-red-100 px-3 py-2 text-xs text-red-700 flex items-start gap-2"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 20 20"
          fill="currentColor"
          class="w-4 h-4 mt-0.5"
        >
          <path
            fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zM9 7a1 1 0 112 0v4a1 1 0 11-2 0V7zm1 7a1.25 1.25 0 100-2.5A1.25 1.25 0 0010 14z"
            clip-rule="evenodd"
          />
        </svg>
        <span>{{ errorMessage }}</span>
      </div>

      <div
        *ngIf="successMessage"
        class="mb-2 rounded-lg bg-emerald-50 border border-emerald-100 px-3 py-2 text-xs text-emerald-700 flex items-center gap-2"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 20 20"
          fill="currentColor"
          class="w-4 h-4"
        >
          <path
            fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.707a1 1 0 00-1.414-1.414L9 10.172 7.707 8.879A1 1 0 006.293 10.293l2 2a1 1 0 001.414 0l4-4z"
            clip-rule="evenodd"
          />
        </svg>
        <span>{{ successMessage }}</span>
      </div>

      <!-- Tenant Info Section -->
      <div class="space-y-4">
        <h3 class="text-sm font-semibold text-slate-900 border-b border-slate-100 pb-2">
          Organization Details
        </h3>
        <div class="grid gap-6 sm:grid-cols-2">
          <div>
            <label class="block text-sm font-bold text-slate-700 mb-1.5"
              >Organization Name</label
            >
            <input
              type="text"
              formControlName="tenantName"
              placeholder="e.g. Acme Corp"
              [class.border-red-300]="form.get('tenantName')?.invalid && form.get('tenantName')?.touched"
       class="w-full rounded-lg border border-slate-300 px-3 py-2.5 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-shadow"
            />
            <p *ngIf="form.get('tenantName')?.invalid && form.get('tenantName')?.touched" class="mt-1 text-xs text-red-600">
              Organization name is required.
            </p>
          </div>
          <div>
            <label class="block text-sm font-bold text-slate-700 mb-1.5"
              >Organization Slug <span class="font-normal text-slate-400">(Optional)</span></label
            >
            <input
              type="text"
              formControlName="tenantSlug"
              placeholder="e.g. acme-corp"
              [class.border-red-300]="form.get('tenantSlug')?.invalid && form.get('tenantSlug')?.touched"
              class="w-full rounded-lg border border-slate-300 px-3 py-2.5 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-shadow"
            />
            <p *ngIf="form.get('tenantSlug')?.invalid && form.get('tenantSlug')?.touched" class="mt-1 text-xs text-red-600">
              Organization slug is required.
            </p>
            <p class="mt-1 text-xs text-slate-400">
              Used in URLs. Will be auto-generated if left blank.
            </p>
          </div>
        </div>
      </div>

      <!-- Admin Info Section -->
      <div class="space-y-4 pt-2">
         <h3 class="text-sm font-semibold text-slate-900 border-b border-slate-100 pb-2">
          Primary Admin Account
        </h3>
        <div class="grid gap-6 sm:grid-cols-2">
          <div class="sm:col-span-2">
            <label class="block text-sm font-bold text-slate-700 mb-1.5"
              >Full Name</label
            >
            <input
              type="text"
              formControlName="adminFullName"
              placeholder="e.g. Jane Doe"
              [class.border-red-300]="form.get('adminFullName')?.invalid && form.get('adminFullName')?.touched"
              class="w-full rounded-lg border border-slate-300 px-3 py-2.5 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-shadow"
            />
            <p *ngIf="form.get('adminFullName')?.invalid && form.get('adminFullName')?.touched" class="mt-1 text-xs text-red-600">
              Full name is required.
            </p>
          </div>
          <div>
            <label class="block text-sm font-bold text-slate-700 mb-1.5"
              >Email Address</label
            >
            <input
              type="email"
              formControlName="adminEmail"
              placeholder="jane@example.com"
              [class.border-red-300]="form.get('adminEmail')?.invalid && form.get('adminEmail')?.touched"
                class="w-full rounded-lg border border-slate-300 px-3 py-2.5 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-shadow"
            />
            <p *ngIf="form.get('adminEmail')?.invalid && form.get('adminEmail')?.touched" class="mt-1 text-xs text-red-600">
              Email address is required.
            </p>
          </div>
          <div>
            <label class="block text-sm font-bold text-slate-700 mb-1.5"
              >Password</label
            >
            <input
              type="password"
              formControlName="adminPassword"
              placeholder="••••••••"
              [class.border-red-300]="form.get('adminPassword')?.invalid && form.get('adminPassword')?.touched"
              class="w-full rounded-lg border border-slate-300 px-3 py-2.5 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-shadow"
            />
             <p class="mt-1 text-xs text-slate-400">
              Must be at least 8 characters long.
            </p>
            <p *ngIf="form.get('adminPassword')?.invalid && form.get('adminPassword')?.touched" class="mt-1 text-xs text-red-600">
              Password must be at least 8 characters long.
            </p>
          </div>
        </div>
      </div>

      <div class="flex justify-end pt-6 border-t border-slate-100">
        <button
          type="submit"
          [disabled]="form.invalid || submitting"
          class="inline-flex items-center gap-2 rounded-lg bg-primary px-6 py-2.5 text-sm font-bold text-white shadow-lg shadow-primary/25 hover:bg-primary-dark hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none transition-all"
        >
          <svg
            *ngIf="!submitting"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            class="w-4 h-4"
          >
            <path
              d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"
            />
          </svg>
          <svg
            *ngIf="submitting"
            class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          {{ submitting ? "Creating..." : "Create Organization" }}
        </button>
      </div>
    </form>
  </div>
</div>
