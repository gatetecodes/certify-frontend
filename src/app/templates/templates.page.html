<div class="grid grid-cols-1 gap-6 lg:grid-cols-12 items-start">
  <!-- Sidebar / List -->
  <aside class="lg:col-span-4 flex flex-col gap-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-bold text-slate-900 flex items-center gap-2">
        Templates
        <span class="inline-flex items-center justify-center rounded-full bg-secondary/20 px-2 py-0.5 text-xs font-medium text-secondary-dark" *ngIf="(templates$ | async)?.length">
          {{ (templates$ | async)?.length }}
        </span>
      </h2>
      <button
        type="button"
        (click)="newTemplate()"
        class="inline-flex items-center gap-1.5 rounded-full bg-white px-4 py-1.5 text-xs font-bold uppercase tracking-wide text-primary border border-primary/20 hover:bg-primary hover:text-white transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
          <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
        </svg>
        New
      </button>
    </div>

    <div class="flex flex-col gap-3">
      <ng-container *ngIf="(templates$ | async) as templates">
        <div *ngIf="templates.length === 0" class="flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-secondary/30 bg-white p-8 text-center">
            <div class="mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-secondary/10 text-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                </svg>
            </div>
            <h3 class="text-sm font-semibold text-slate-900">No templates</h3>
            <p class="mt-1 text-xs text-slate-500">Get started by creating a new certificate template.</p>
        </div>

        <div
            *ngFor="let template of templates"
            (click)="selectTemplate(template.id, template.name)"
            class="group relative cursor-pointer rounded-xl border p-4 transition-all hover:shadow-sm"
            [ngClass]="{
              'border-primary/50 bg-white/60': template.id === selectedTemplateId,
              'border-white bg-white': template.id !== selectedTemplateId
            }"
        >
            <div class="flex items-start justify-between">
                <div>
                    <div class="font-bold text-slate-900 group-hover:text-primary transition-colors">{{ template.name }}</div>
                    <div class="mt-1 flex items-center gap-2 text-xs text-slate-500">
                        <span class="font-medium">v{{ template.version }}</span>
                        <span>&middot;</span>
                        <span
                            class="inline-flex items-center gap-1 rounded-full px-1.5 py-0.5 font-medium"
                            [class.bg-green-100]="template.active"
                            [class.text-green-700]="template.active"
                            [class.bg-slate-100]="!template.active"
                            [class.text-slate-600]="!template.active"
                        >
                            <span class="h-1.5 w-1.5 rounded-full" [class.bg-green-500]="template.active" [class.bg-slate-400]="!template.active"></span>
                            {{ template.active ? 'Active' : 'Inactive' }}
                        </span>
                    </div>
                </div>
                <div *ngIf="template.id === selectedTemplateId" class="text-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                        <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                    </svg>
                </div>
            </div>
        </div>
      </ng-container>
    </div>
  </aside>

  <!-- Editor -->
  <div class="lg:col-span-8 rounded-2xl border border-white/50 bg-white p-6 shadow-lg shadow-secondary/5">
    <div class="mb-6 flex items-center justify-between border-b border-slate-100 pb-4">
      <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2">
        <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-secondary/10 text-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
            </svg>
        </div>
        <ng-container *ngIf="selectedTemplateId; else createLabel">Edit Template</ng-container>
        <ng-template #createLabel>Create Template</ng-template>
      </h2>
    </div>

    <form (ngSubmit)="save()" #templateForm="ngForm" class="space-y-6">
      <div *ngIf="saveError" class="mb-2 rounded-lg bg-red-50 border border-red-100 px-3 py-2 text-xs text-red-700 flex items-start gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mt-0.5">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9 7a1 1 0 112 0v4a1 1 0 11-2 0V7zm1 7a1.25 1.25 0 100-2.5A1.25 1.25 0 0010 14z" clip-rule="evenodd" />
        </svg>
        <span>{{ saveError }}</span>
      </div>

      <div *ngIf="saveSuccess && !saveError" class="mb-2 rounded-lg bg-emerald-50 border border-emerald-100 px-3 py-2 text-xs text-emerald-700 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.707a1 1 0 00-1.414-1.414L9 10.172 7.707 8.879A1 1 0 006.293 10.293l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
        </svg>
        <span>Template saved.</span>
      </div>

      <div class="grid gap-6 sm:grid-cols-2">
        <div>
          <label class="block text-sm font-bold text-slate-700 mb-1.5">Name</label>
          <input
            type="text"
            name="name"
            [(ngModel)]="form.name"
            required
            placeholder="e.g., Standard Certificate"
            class="w-full rounded-lg border border-slate-300 px-3 py-2.5 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-shadow"
          />
        </div>
        <div class="sm:col-span-2">
          <label class="block text-sm font-bold text-slate-700 mb-1.5">Description</label>
          <textarea
            name="description"
            rows="2"
            [(ngModel)]="form.description"
            placeholder="Briefly describe this template..."
            class="w-full rounded-lg border border-slate-300 px-3 py-2.5 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-shadow"
          ></textarea>
        </div>
      </div>

      <div>
        <label class="flex justify-between text-sm font-bold text-slate-700 mb-1.5">
          HTML Template
          <span class="text-xs font-medium text-secondary bg-secondary/10 px-2 py-0.5 rounded">Thymeleaf syntax</span>
        </label>
        <div class="relative rounded-lg border border-slate-300 bg-slate-900 overflow-hidden">
            <div class="absolute top-2 right-2">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-slate-500">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                </svg>
            </div>
            <textarea
            name="htmlTemplate"
            rows="12"
            [(ngModel)]="form.htmlTemplate"
            required
            class="w-full bg-transparent p-4 text-sm font-mono text-slate-200 focus:outline-none placeholder-slate-600"
            placeholder="<html>...</html>"
            ></textarea>
        </div>
      </div>

      <!-- Placeholders Section -->
      <div class="rounded-xl border border-slate-200 bg-slate-50/50 p-5">
        <header class="mb-4 flex items-center justify-between">
          <h3 class="text-sm font-bold text-slate-900 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-secondary">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" />
            </svg>
            Placeholders
          </h3>
          <button
            type="button"
            (click)="addPlaceholder()"
            class="text-xs font-bold text-primary hover:text-primary-dark flex items-center gap-1"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
            </svg>
            Add field
          </button>
        </header>

        <div class="space-y-2">
          <div
            class="flex flex-wrap items-start gap-2"
            *ngFor="let p of form.placeholders; index as i"
          >
            <input
              type="text"
              name="key-{{ i }}"
              placeholder="Key"
              [(ngModel)]="p.key"
              required
              class="flex-1 min-w-[140px] rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none"
            />
            <input
              type="text"
              name="label-{{ i }}"
              placeholder="Label"
              [(ngModel)]="p.label"
              required
              class="flex-1 min-w-[140px] rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none"
            />
            <select
              name="type-{{ i }}"
              [(ngModel)]="p.type"
              class="rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none bg-white"
            >
              <option value="text">Text</option>
              <option value="date">Date</option>
              <option value="number">Number</option>
            </select>

            <label class="flex items-center gap-1.5 rounded-lg border border-slate-300 bg-white px-3 py-2 cursor-pointer hover:bg-slate-50 transition-colors">
              <input
                type="checkbox"
                name="required-{{ i }}"
                [(ngModel)]="p.required"
                class="rounded border-slate-300 text-primary focus:ring-primary h-4 w-4"
              />
              <span class="text-xs font-medium text-slate-600 select-none">Req.</span>
            </label>

            <button
              type="button"
              (click)="removePlaceholder(i)"
              class="rounded-lg p-2 text-slate-400 hover:bg-red-50 hover:text-red-600 transition-colors"
              title="Remove"
            >
               <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          <div *ngIf="form.placeholders.length === 0" class="flex flex-col items-center py-4 text-center">
            <span class="text-sm text-slate-500">No placeholders defined.</span>
            <span class="text-xs text-slate-400">Add fields to make your template dynamic.</span>
          </div>
        </div>
      </div>

      <div class="flex justify-end pt-4 border-t border-slate-100">
        <button
          type="submit"
          [disabled]="!templateForm.form.valid || saving"
          class="inline-flex items-center gap-2 rounded-lg bg-primary px-6 py-2.5 text-sm font-bold text-white shadow-lg shadow-primary/25 hover:bg-primary-dark hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none transition-all"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
          </svg>
          {{ saving ? 'Savingâ€¦' : 'Save Template' }}
        </button>
      </div>
    </form>
  </div>
</div>
